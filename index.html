<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Gift Idea Generator</title>
<script>
document.addEventListener('DOMContentLoaded', function() {
  document.getElementById('giftForm').addEventListener('submit', function(event) {
    event.preventDefault(); 

    const reasonForArgument = document.getElementById('reason').value;
    const ageCategory = document.getElementById('ageCategory').value;
    const budgetCategory = document.getElementById('budgetCategory').value;
    const fightSeverity = document.getElementById('fightSeverity').value;

    // Simple validation (can be improved as needed)
    if(reasonForArgument && ageCategory && budgetCategory && fightSeverity) {
      generateGiftIdeas(reasonForArgument, ageCategory, budgetCategory, fightSeverity);
    } else {
      alert('Please fill in all fields.');
    }
  });

  async function generateGiftIdeas(reasonForArgument, ageCategory, budgetCategory, fightSeverity) {
    try {
      const response = await fetch('https://api.openai.com/v1/chat/completions', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
          'Authorization': 'Bearer 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' // Securely handled API key
        },
        body: JSON.stringify({
          model: "gpt-3.5-turbo",
          messages: [
            {
              "role": "system",
              "content": "You are a helpful assistant. Provide three thoughtful gift ideas with a one-sentence explanation for each, based on the user's specific situation."
            },
            {
              "role": "user",
              "content": `We had a fight about ${reasonForArgument}. Age category: ${ageCategory}, Budget: ${budgetCategory}, Severity: ${fightSeverity}. What are three suitable gift ideas?`
            }
          ],
          max_tokens: 50
        })
      });

      if (!response.ok) {
        throw new Error(`HTTP error! status: ${response.status}`);
      }

      const data = await response.json();
      displayGiftIdeas(data.choices[0].message.content);
    } catch (error) {
      console.error('Error retrieving the gift ideas:', error);
      displayGiftIdeas('Sorry, there was a problem retrieving the gift ideas.');
    }
  }

  function displayGiftIdeas(giftIdeas) {
    document.getElementById('giftIdeas').innerText = giftIdeas;
  }
});
</script>

</head>
<body>
    <h1>Gift Idea Generator for Apologies</h1>
    <form id="giftForm">
        <label for="reason">Reason for Argument:</label>
        <input type="text" id="reason" name="reason" required><br><br>

        <label for="ageCategory">Age Category:</label>
        <select id="ageCategory" name="ageCategory" required>
            <option value="Adults">Adults</option>
            <option value="Middle-Aged">Middle-Aged</option>
            <option value="Seniors">Seniors</option>
        </select><br><br>

        <label for="budgetCategory">Budget Category:</label>
        <select id="budgetCategory" name="budgetCategory" required>
            <option value="Economy">Economy</option>
            <option value="Moderate">Moderate</option>
            <option value="Premium">Premium</option>
            <option value="Luxury">Luxury</option>
        </select><br><br>

        <label for="fightSeverity">Severity of the Fight:</label>
        <select id="fightSeverity" name="fightSeverity" required>
            <option value="Mild">Mild</option>
            <option value="Serious">Serious</option>
            <option value="Grave">Grave</option>
        </select><br><br>

        <button type="submit">Generate Gift Ideas</button>
    </form>

    <div id="giftIdeas"></div>
</body>
</html>
